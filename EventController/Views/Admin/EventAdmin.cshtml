@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}
<!-- Notifications -->
@if (TempData["Error"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        @TempData["Error"]
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}
@if (TempData["Notification"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        @TempData["Notification"]
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}

<!-- Event List Table -->
<div class="card shadow-sm mb-4">
    <div class="card-header bg-primary text-white fw-bold">
        Event List
    </div>
    <div class="d-flex align-items-center mb-3 flex-wrap gap-2">
        <form method="get" class="d-flex align-items-center gap-2">
            <label for="searchTitle" class="form-label mb-0">Search:</label>
            <input type="text" id="searchTitle" name="searchTitle" class="form-control form-control-sm" 
                   placeholder="Event title..." value="@ViewBag.SearchTitle" style="width: 200px;" />
            <button type="submit" class="btn btn-sm btn-primary">
                <i class="bi bi-search"></i>
            </button>
            @if (!string.IsNullOrEmpty(ViewBag.SearchTitle))
            {
                <a href="@Url.Action("EventAdmin", "Admin")" class="btn btn-sm btn-secondary">
                    <i class="bi bi-x-circle"></i> Clear
                </a>
            }
        </form>
        <form method="get" class="d-flex align-items-center gap-2">
            <label for="sortSelect" class="form-label mb-0">Status:</label>
            <select id="sortSelect" name="status" class="form-select form-select-sm w-auto" onchange="this.form.submit()">
                <option disabled selected>All</option>
                <option value="Inactive">Inactive ⬍</option>
                <option value="Upcoming">Upcoming ⬍</option>
                <option value="Active">Active ⬍</option>
                <option value="Cancelled">Cancelled ⬍</option>
                <option value="Expired">Expired ⬍</option>
            </select>
        </form>
        <form method="get" class="d-flex align-items-center gap-2">
            <label for="categorySelect" class="form-label mb-0">Category:</label>
            <select id="categorySelect" name="category" class="form-select form-select-sm w-auto" onchange="this.form.submit()">
                <option value="">All</option>
                @foreach (var cat in ViewBag.listCategory as List<EventCategory>)
                {
                    <option value="@(cat.CategoryID)" >
                        @cat.CategoryName
                    </option>
                }
            </select>
        </form>
        <form method="get" class="d-flex align-items-center gap-2">
            <label for="venueSelect" class="form-label mb-0">Venue:</label>
            <select id="venueSelect" name="venue" class="form-select form-select-sm w-auto" onchange="this.form.submit()">
                <option value="">All</option>
                @foreach (var ven in ViewBag.listVenue as List<Venue>)
                {
                    <option value="@(ven.VenueID)">
                        @ven.Name
                    </option>
                }
            </select>
        </form>

        <a asp-action="CreateEvent" asp-controller="Event" class="btn btn-primary btn-sm ms-2">
            <i class="bi bi-plus-circle me-1"></i> Create Event
        </a>
    </div>
    <div class="card-body p-0">
        <table class="table table-hover mb-0">
            <thead class="table-light">
                <tr>
                    <th>Event</th>
                    <th>Image</th>
                    <th>Category</th>
                    <th>Start Time</th>
                    <th>End Time</th>
                    <th>Status</th>
                    <th>Max Attendees</th>
                    <th>Price</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in ViewBag.EventList as List<Event>)
                {
                    var start = item.StartTime;
                    var end = item.EndTime;

                    <tr>
                        <!-- Event Info -->
                        <td>
                            <div class="fw-semibold">@item.Title</div>
                            <small class="text-muted">@item.Venue?.Name</small>
                        </td>

                        <td>
                            <img src="@(item.ImageUrl != null ? Url.Content("~/" + item.ImageUrl) : Url.Content("~/img/events/unknown.png"))"
                                 alt="Event Poster"
                                 style="width: 80px; height: 60px; object-fit: cover; border-radius: 5px;" />
                        </td>
                        <!-- Category -->
                        <td>
                            <span class="badge bg-info text-dark">
                                @item.Category?.CategoryName
                            </span>
                        </td>

                        <!-- Start Time -->
                        <td>@start.ToString("dd MMM yyyy - hh:mm tt")</td>

                        <td>@end.ToString("dd MMM yyyy - hh:mm tt")</td>

                        <!-- Duration -->
                        <td>@item.Status</td>

                        <!-- Attendees -->
                        <td>
                            <span class="fw-bold text-primary">
                                @(item.MaxAttendees)
                            </span>
                        </td>
                        @if (item.Price == 0)
                        {
                            <td style="color: green">Free</td>
                        }
                        else
                        {
                            <td>@item.Price.ToString("N0") VND</td>
                        }

                        <td>
                            <div class="btn-group" role="group">
                                <a href="@Url.Action("Index", "Event", new { id = item.EventID })" class="btn btn-sm btn-outline-primary" title="View">
                                    <i class="bi bi-eye"></i>
                                </a>
                                @if (item.VenueID.HasValue)
                                {
                                    <a asp-action="VenueTimeline" asp-route-venueId="@item.VenueID" asp-route-eventId="@item.EventID" 
                                       class="btn btn-sm btn-outline-info" title="View Venue Schedule">
                                        <i class="bi bi-calendar3"></i>
                                    </a>
                                }
                                @if (item.Status == "Inactive")
                                {
                                    <a asp-action="AcceptEvent" asp-route-id="@item.EventID" asp-controller="Admin"
                                       class="btn btn-sm btn-outline-success"
                                       title="Accept this event"
                                       onclick="return confirm('Are you sure you want to accept this event?');">
                                        <i class="bi bi-check-circle"></i> Approve
                                    </a>
                                }
                                @if (item.Status == "Upcoming" || item.Status == "Active")
                                {
                                    <a asp-action="InactivateEvent" asp-route-id="@item.EventID" asp-controller="Admin"
                                       class="btn btn-sm btn-outline-warning"
                                       title="Set this event to Inactive (will not display on homepage)"
                                       onclick="return confirm('Are you sure you want to set this event to Inactive? It will not be displayed on the homepage.');">
                                        <i class="bi bi-dash-circle"></i> Inactive
                                    </a>
                                    <a asp-action="CancelEvent" asp-route-id="@item.EventID" asp-controller="Admin"
                                       class="btn btn-sm btn-outline-danger"
                                       title="Cancel this event"
                                       onclick="return confirm('Are you sure you want to cancel this event? This action cannot be undone.');">
                                        <i class="bi bi-x-circle"></i> Cancel
                                    </a>
                                }
                            </div>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>
    </div>